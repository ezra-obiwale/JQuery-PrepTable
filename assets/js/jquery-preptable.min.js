(function(){var a={length:0},b={};jQuery.fn.prepTable=function(g){var f={columns:[],data:[],ajax:null,append:false,limits:{values:[10,20,50,100,200],all:true,current:10},searchable:true,sortable:true,label:true,pagination:{firstLast:false,nextPrevious:true,numbers:false,maxButtons:12},loading_message:"Loading table...",empty_message:"NO ENTRIES FOUND.",display_errors:false,log_errors:true,log_data:false,alert_errors:true,cache:false,createDivs:true,createRow:function(u,t,s){if($.isPlainObject(t)&&f.columns.length){$.each(f.columns,function(x,w){$(u).append("<td>"+t[w.data]+"</td>")})}else{if($.isArray(t)){$.each(t,function(x,w){$(u).append("<td>"+w+"</td>")})}else{p($(this).parent().attr("id"),"T4","DATA.data["+s+"] must be either an array or an object")}}}};jQuery.extend(f,g);function o(s){if(a[s].sortable===false||(a[s].sortable==undefined&&!f.sortable)){return}$.each($("#"+s+">table>thead>tr>th"),function(u,t){if($(this).hasClass("no-sort")||(f.columns[u]&&f.columns[u].sortable===false)){return true}$(t).append("<span>&nbsp;&nbsp;&nbsp;&nbsp;</span>");$(this).addClass("sort").attr("title","Click to order").data("pos",u);if(f.columns[u]){$(this).data("colName",f.columns[u].data)}})}function e(v){var s=a[v].limitsValues?a[v].limitsValues.split(","):f.limits.values,u=a[v].limitsCurrent||f.limits.current;if(!s){console.error("Limits must have values of array values");return}var t=$("#"+v+" .before-table").append('<label class="jq-limit">Show <select /> entries</label>').find(".jq-limit>select");if(a[v].limits===false||(a[v].limits===undefined&&!f.limits)){t.parent().css("display","none");u="all"}$.each(s,function(x,w){var y=(w==u)?'selected="selected"':"";t.append("<option "+y+' value="'+w+'">'+w+"</option>")});if(a[v].limitsAll||(a[v].limitsAll!==false&&f.limits.all)){t.append("<option "+(("all"==u)?'selected="selected"':"")+' value="">All</option>')}}function i(t){var s=$("#"+t+" .before-table").append('<label class="jq-search">Search <input type="text" /></label>').children("label.jq-search");if(a[t].searchable===false||(a[t].searchable===undefined&&!f.searchable)){s.css("display","none")}$.each(f.columns,function(w,u){if(u.searchable!==undefined&&!u.searchable){return true}if(!a[t]["searchables"]){a[t]["searchables"]=""}if(w){a[t].searchables+=","}a[t].searchables+=u.data})}function l(w,t,u){$("#"+w+" .after-table>.jq-label").remove();if(t.label===false||(t.label===undefined&&!f.label)||!t.data.length){return}var v=(t.start?t.start*r(w)+1:1),s=v+r(w)-1;if(!s||s>t.total){s=t.total}$("#"+w+" .after-table").append('<div class="jq-label">Showing <span class="start">'+(t.append?1:v)+'</span> to <span class="showing">'+(t.append&&u?$("#"+w+">table>tbody>tr").length:s)+'</span> of <span class="total">'+t.total+"</span> entries</div>")}function h(z,J){var v=J.start+1;$("#"+z+" .after-table>.jq-pagination").remove();if(J.pagination===false||!f.pagination||!J.data.length){return}if(typeof f.pagination==="boolean"){f.pagination={firstLast:false,nextPrevious:true,numbers:false,maxButtons:12}}var u=J.start?J.start*r(z):0,w="",C="",t="",x=J.paginationMaxButtons||f.pagination.maxButtons;if(!x){x=12}if(J.paginationNextPrevious||(J.paginationNextPrevious!==false&&f.pagination.nextPrevious)){C="<button "+(u===0?'disabled="disabled"':"")+' class="prev '+(u===0?"disabled":"")+'">&larr; Previous</button>';w="<button "+(isNaN(r(z))||u+r(z)>=J.total?'disabled="disabled"':"")+' class="next '+(isNaN(r(z))||u+r(z)>=J.total?"disabled":"")+'">Next &rarr;</button>';x-=2}if(J.paginationFirstLast||(J.paginationFirstLast!==false&&f.pagination.firstLast)){C="<button "+(u===0?'disabled="disabled"':"")+' class="first '+(u===0?"disabled":"")+'">&larrb; First</button>'+C;w+="<button "+(isNaN(r(z))||u+r(z)>=J.total?'disabled="disabled"':"")+' class="last '+(isNaN(r(z))||u+r(z)>=J.total?"disabled":"")+'">Last &rarrb;</button>';x-=2}if(J.paginationNumbers||(J.paginationNumbers!==false&&f.pagination.numbers&&x)){if(x<8){x=8}var I=Math.ceil(J.total/r(z)),A=I>x?x:I;var s=Math.floor(A/2),H=Math.floor(s/3),F=s-H,E=F,B=1,G=v;if(v<=F*2-H){F=false}else{if(v>=I-E-H+1){H+=E;G=I;E=false}}for(var D=1;D<=A;D++){if(B>I){break}t+='<button id="_'+(D-1)+'"';if(B===v){t+=' class="current" disabled="disabled"'}t+=">"+B+"</button>";var y=B;B++;if(I!==A&&((F&&D===F)||(E&&D===A-E+1))){if(D===F){if(D>v){G=Math.ceil(I/2)}B=G-H}else{B=I-E+2}if(B>y+1){t+='<span class="ellipsis">...</span>'}if(B===y){B++}}}}$("#"+z+" .after-table").append('<div class="jq-pagination">'+C+t+w+"</div>")}function p(u,s,t){t="ERROR "+s+" (http://ezra-obiwale.github.io/JQuery-PrepTable/#errors):\r  -  "+t;if(a[u].logErrors||(a[u].logErrors!==false&&f.log_errors)){console.error(t)}if(a[u].displayErrors||(a[u].displayErrors!==false&&f.display_errors)){$("#"+u+" .jq-msg").addClass("error").html(t)}if(a[u].alertErrors||(a[u].alertErrors!==false&&f.alert_errors)){alert(t)}}function r(s){return parseInt($("#"+s+" .before-table .jq-limit>select").val())}function k(s){if(!b[s]){b[s]={}}b[s]["rows"]=$("#"+s+">table>tbody>tr");a[s].total=b[s].rows.length;if(r(s)!==""){$("#"+s+">table>tbody>tr").each(function(u,t){if(u==r(s)){return false}$(t).addClass("__showing")});$("#"+s+">table>tbody>tr:not(.__showing)").detach();$("#"+s+">table>tbody>tr").removeClass("__showing")}l(s,$.extend({data:$("#"+s+">table>tbody>tr"),total:b[s]["rows"].length},a[s]),true);h(s,$.extend({data:$("#"+s+">table>tbody>tr"),total:b[s]["rows"].length},a[s]))}function n(y,x){var s=$("#"+y+">table>tbody"),u=$("#"+y+" .before-table .jq-search>input").val().toLowerCase(),w=0,v=0,t=0;$("#"+y+" .jq-msg").addClass("info").hide();if(a[y].order&&(!b[y].order||b[y].order&&(a[y].order.index!==b[y].order.index||a[y].order.dir!==b[y].order.dir))){d(y);b[y].order=a[y].order}$.each(b[y].rows,function(A,z){if(u&&$(z).text().toLowerCase().indexOf(u)==-1){return true}else{if(t<x){if(u){w++}t++;return true}else{if(r(y)&&v===r(y)){w++;return(u)}}}s.append(z);w++;v++});w=u?w:b[y]["rows"].length;l(y,$.extend({data:$("#"+y+">table>tbody>tr"),total:w},a[y]),true);h(y,$.extend({data:$("#"+y+">table>tbody>tr"),total:w},a[y]));if(!$("#"+y+">table>tbody>tr").length){$("#"+y+" .jq-msg").addClass("info").removeClass("active").html(a[y].emptyMessage||f.empty_message).show()}}function d(s){return b[s].rows.sort(function(v,u){var t=$(v).children("td").eq(a[s].order.index).text().toUpperCase(),w=$(u).children("td").eq(a[s].order.index).text().toUpperCase();if(t<w){return(a[s].order.dir==="desc")?1:-1}else{return(a[s].order.dir==="desc")?-1:1}return 0})}function q(u,t,s){if(!a[u].append||!s){$("#"+u+">table>tbody>tr:not(._"+(t+1)+")").remove()}if(a[u].cache&&b[u]&&b[u][t]&&b[u][t].limit==r(u)){if(s||!a[u].append){$.extend(a[u],b[u][t]);j(u)}else{l(u,b[u][t],true);h(u,b[u][t])}}else{if(!s&&a[u].append){l(u,b[u][t],true);h(u,b[u][t])}else{if(b[u].rows){n(u,r(u)?t*r(u):0)}else{c(u)}}}}function c(v){if(a[v]&&!a[v].ajax&&a[v].data.length>r(v)){j(v);return}else{if(!a[v].ajax){return}}$("#"+v+" .jq-msg").addClass("info").html(a[v].loadingMessage||f.loading_message).fadeIn();var t=a[v].ajax.url,u={},s=r(v);if(a[v].ajax.type.toLowerCase()==="get"){t+="?search[columns]="+encodeURIComponent(a[v].searchables)+"&search[value]="+encodeURIComponent($("#"+v+" .before-table>label.jq-search>input").val())+"&limit="+(!isNaN(s)?s:"")+"&start="+(!isNaN(s)?s*a[v].start:0);if(a[v].order){t+="&order[column]="+a[v].order.column+"&order[dir]="+a[v].order.dir}}else{u={search:{columns:a[v].searchables,value:encodeURIComponent($("#"+v+" .before-table>label.jq-search>input").val())},limit:!isNaN(s)?s:"",start:!isNaN(s)?s*a[v].start:0};if(a[v].order){u.order=a[v].order}}$("#"+v+" .after-table>.jq-label,#"+v+" .after-table>.jq-pagination").remove();$.ajax({url:t,data:u,type:a[v].ajax.type,success:function(w){if(a[v].logData||(a[v].logData!==false&&f.log_data)){console.info("RESPONSE",w)}if(typeof w==="string"){w=$.parseJSON(w)}$("#"+v+" .jq-msg").html("");m(v,w);$("#"+v+" .jq-msg").hide()},error:function(w){p(v,"T0","Connection error: "+w.responseText)}})}function m(t,s){if($.isArray(s)){a[t].data=s;a[t].start=0;a[t].total=s.length}else{if($.isPlainObject(s)){if(!$.isArray(s.data)){p(t,"T3","Data in <Response> must be an array");return false}else{if(isNaN(s.total)){p(t,"T2","Response object must contain key <total> with an <integer value>");return false}else{a[t].data=s.data;a[t].total=s.total}}}else{p(t,"T1","Response data must be an object");return false}}a[t].timeout=0;a[t].limit=r(t);j(t)}function j(v){var u=a[v];if(!u.data.length){$("#"+v+" .jq-msg").addClass("info").removeClass("active").html(a[v].emptyMessage||f.empty_message)}if(!u.total){return}if(!b[v]){b[v]={}}b[v][u.start]=$.extend({},u);h(v,u);l(v,u);var t=$("#"+v+">table");if(!t.children("tbody").is("tbody")){t.append("<tbody />")}var s=t.children("tbody");if(!a[v].append){s.html("")}$.each(u.data,function(x,w){if(!u.ajax){if(u.start&&x<u.start){return true}if(u.total>=u.data.length&&x===(r(v)||0+u.start)){return false}}var y=s.append("<tr />").find("tr:last-child");s.children().addClass("_"+(a[v].start+1));if(u.createRow){u.createRow.call($("#"+v+">table")[0],y[0],w,x)}else{if(typeof f.createRow==="function"){f.createRow.call($("#"+v+">table")[0],y[0],w,x)}}})}this.each(function(t,s){var y="table_"+a.length;a.length++;a[y]=$.extend({},$(s).data());a[y]["start"]=0;a[y].config=f;if(typeof a[y].append!=="boolean"){a[y]["append"]=f.append}if(typeof a[y].cache!=="boolean"){a[y]["cache"]=f.cache}$(s).wrap('<div id="'+y+'" class="jq-table" />');if(a[y].createDivs!==false||(a[y].createDivs===undefined&&f.createDivs)){$("#"+y).prepend('<div class="before-table" />');$("#"+y).append('<div class="after-table"><div class="jq-msg"></div></div>')}else{if(!$(s).children("thead").length){$(s).append("<thead/>")}if(!$(s).children("tfoot").length){$(s).append("<tfoot/>")}var w=$(s).children("thead").children("tr:first-child").children("th").length;$(s).children("thead").prepend('<tr><td class="before-table" colspan="'+(w?w:100)+'">&nbsp;</td></tr>');$(s).children("tfoot").append('<tr><td class="after-table" colspan="'+(w?w:100)+'"><div class="jq-msg"></div></td></tr>')}o(y);e(y);i(y);if($(s).data("createRow")){var u=$(s).data("createRow");if(window[u]&&typeof window[u]==="function"){a[y]["createRow"]=window[u]}else{if(u.indexOf(".")!=-1){var x=window;$.each(u.split("."),function(A,z){if(x[z]){x=x[z]}else{return false}});if(typeof x==="function"){a[y]["createRow"]=x}}}}if($(s).data("ajaxUrl")){a[y]["ajax"]={url:$(s).data("ajaxUrl"),type:$(s).data("ajaxType")?$(s).data("ajaxType"):"get"};c(y)}else{if(f.ajax){if(typeof f.ajax==="string"){a[y]["ajax"]={url:f.ajax,type:"get"}}else{if($.isPlainObject(f.ajax)&&!f.ajax.type){a[y]["ajax"]=f.ajax;a[y].ajax.type="get"}}c(y)}else{if(f.data.length){m(y,f.data)}else{k(y)}}}$(s).parent().on("change",".before-table .jq-limit>select",function(){var v=$(this).closest(".jq-table").attr("id");if($(this).val()&&a[v].start*parseInt($(this).val())>a[v].total){a[v].start=Math.floor(a[v].total/parseInt($(this).val()))-1}if(a[v].append){a[v].start=0;$("#"+v+">table>tbody").html("");b[v]={}}q(v,a[v].start,a[v].append)});$(s).parent().on("click","table>thead>tr>th.sort",function(){var v=$(this).closest(".jq-table").attr("id");$(this).siblings().removeClass("asc desc");a[v].order={index:$(this).index(),column:$(this).data("colName")};if($(this).hasClass("asc")){a[v].order.dir="desc";$(this).removeClass("asc").addClass("desc")}else{a[v].order.dir="asc";$(this).removeClass("desc").addClass("asc")}console.log("click");q(v,a[v].start,a[v].append)});$(s).parent().on("click",".after-table>.jq-pagination>button",function(){if($(this).hasClass("disabled")){return}$(this).addClass("disabled");var A=$(this).closest(".jq-table").attr("id"),v=false;if($(this).html().indexOf("First")!==-1){a[A].start=0}else{if($(this).html().indexOf("Last")!==-1){a[A].start=Math.floor(a[A].total/r(A));if(a[A].start*r(A)>=a[A].total){a[A].start--}v=true}else{if($(this).html().indexOf("Next")!==-1){a[A].start++;v=true}else{if($(this).html().indexOf("Previous")!==-1){if(a[A].start>0){a[A].start--}}else{var z=parseInt($(this).text());if(z-1>a[A].start){v=true}a[A].start=z-1}}}}q(A,a[A].start,v)});$(s).parent().on("keyup",".before-table .jq-search>input",function(){var v=$(this).closest(".jq-table").attr("id");clearTimeout(a[v].timeout);a[v].start=0;a[v].timeout=setTimeout(q,500,v,a[v].start,a[v].append)})});return this}})(jQuery);
